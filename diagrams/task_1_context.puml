@startuml
!include https://raw.githubusercontent.com/plantuml-stdlib/C4-PlantUML/master/C4_Component.puml
' uncomment the following line and comment the first to use locally
' !include C4_Component.puml

LAYOUT_WITH_LEGEND()

title Контексты существующей системы 'Тёплый дом'

Container_Boundary(customer, "Домен: Клиент и его дом") {
    Person_Ext(client, "Клиент")
    System_Ext(hvac_sys, "Система отопления", "Управление температурой в доме")
}

Container_Boundary(web_application, "Домен: Web-приложение") {
    System_Ext(web_app,  "Web приложение",    "Управление устройствами клиентов")
}

Enterprise_Boundary(company, "Тёплый дом") {
    System_Boundary(hvac_domain, "Домен: системы отопления") {
        Component(hvac_sys_management, "Управление реестром систем отопления")
        Component(hvac_telemetry,      "Управление телеметрией")
        Component(hvac_control,        "Управление системами отопления")
        ComponentDb(hvac_db, "Database", "PostgeSQL", "Хранит информацию об устройствах и их телеметрии")
        Rel(hvac_sys_management, hvac_db, "Создает новые записи")
        Rel(hvac_telemetry,      hvac_db, "Сохраняет и запрашивает телеметрию")
        Rel(hvac_control,        hvac_db, "Сохраняет статус системы отопления")
    }

    System_Boundary(auth_domain, "Домен: система клиентов компании") {
        Component(auth_sys_management, "Управление реестром пользователей")
        Component(auth_sys,            "Авторизация пользователей")
        ComponentDb(auth_db, "Database", "PostgeSQL", "Хранит учетные записи")
        Rel(auth_sys_management, auth_db, "Поддерживает реестр пользователей")
        Rel(auth_sys,            auth_db, "Сохраняет статус текущей сессии пользователя")
    }
}

Lay_D(customer, web_application)

Rel(client, web_app,          "Посылает сигналы управления и получает телеметрию")
Rel(web_app, auth_sys,        "Авторизация")
Rel(web_app, hvac_control,    "Посылет команды, запрашивает телеметрию")
Rel(hvac_sys, hvac_telemetry, "Посылает телеметрию")
Rel(hvac_control, hvac_sys,   "Команды управления")
@enduml